.include "m128def.inc"   ; ??????????? ???? ? ??????????? ???????? ATmega128

.def temp = r16          ; ?????????? ?????????? ??????
.def cnt = r17           ; ?????????? ?????? ??????????

.org 0x0100              ; ?????????? ????? ????????

ldi temp, 0xFF           ; ???????????? ??? ????? ?? ?????
out DDRD, temp
out PORTD, temp          ; ???????????? ??? ????? ?? ??????? ??????

ldi cnt, 0x00            ; ????????????? ?????????

ldi temp, 0b00100001     ; ???????????? ????? ?????????? ??????? 1 (OC1B) ?? CTC
out TCCR1A, temp         ; ?? ???????????? ??????????? ?? 1
ldi temp, (1<<WGM12)     ;  ???????????? ????? ?????????? ??????? 1 ?? CTC
out TCCR1B, temp         ; ?? ???????????? ??????????? ?? 1

ldi temp, 0x74           ; ???????????? ???????? ??????? OCR1B
out OCR1BH, temp         ; ? ??????? ????
ldi temp, 0x80           ; ? ???????? ????
out OCR1BL, temp

ldi temp, (1<<OCIE1B)    ; ?????????? ??????????? ?? ????? ? ???????? OCR1B
out TIMSK, temp

sei                      ; ?????????? ????????? ???????????

loop:                   ; ??????? ???????????? ?????
  rjmp loop

; ???????? ??????????? ?? ????? ? ???????? OCR1B
TIMER1_COMPB_vect:
  cpi cnt, 0x00          ; ??????????? ???????? ??????????
  breq turn_on           ; ???? ???????? ????, ???????? ???????????
  cpi cnt, 0x05          ; ?????? ???????????, ?? ???????? ???? ?'???
  inc cnt                ; ?????? ?????????? ????????? ?? ???????
  reti                   ; ?????????? ???????? ???????????

turn_on:
  ldi temp, 0b00000001   ; ???????????? ???????? ??? ????? D ? 1
  out PORTD, temp
  ldi temp, 0b00100000   ; ???????????? ?'???? ??? ????? D ? 1
